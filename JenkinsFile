pipeline {
	agent any

	stages {

		stage('chMod') {
			steps {
				sh 'chmod +=rwx c-gradle-code.sbt/gradlew'
			}
		}

		stage('Cloning m2-repo') {
			steps {
				sh 'rm -dfr peterlavalle.sbt/target/m2-repo/'
				sh 'git init peterlavalle.sbt/target/m2-repo/'
				dir ('peterlavalle.sbt/target/m2-repo/') {
					sh 'git remote add origin git@github.com:g-pechorin/m2-repo.git'
					sh 'git fetch'
					sh 'git checkout gh-pages'
					sh 'git pull origin gh-pages'
				}
			}
		}

		stage('test peterlavalle.sbt/') {
			steps {
				dir ('peterlavalle.sbt/') {
					sh 'java -jar ./sbt-launch.jar +test'
				}
			}
		}

		stage('peterlavalle.sbt/ +publish') {
			steps {
				dir ('peterlavalle.sbt/') {
					sh 'java -jar ./sbt-launch.jar +publish'
				}
			}
		}

		stage('peterlavalle.sbt/ +publishLocal') {
			steps {
				dir ('peterlavalle.sbt/') {
					sh 'java -jar ./sbt-launch.jar +publishLocal'
				}
			}
		}

		stage('peterlavalle-gbt.sbt/ publish') {
			steps {
				dir ('peterlavalle-gbt.sbt/') {
					sh './gradlew publish'
				}
			}
		}

		stage('c-gradle-code.sbt/ publish') {
			steps {
				dir ('c-gradle-code.sbt/') {
					sh './gradlew publish'
				}
			}
		}

		stage('ormsub2011.sbt/ publish') {
			steps {
				dir ('ormsub2011.sbt/') {
					sh './gradlew publish'
				}
			}
		}

		stage('jinn5.sbt/ publish') {
			steps {
				dir ('jinn5.sbt/') {
					sh './gradlew publish'
				}
			}
		}
		
		stage('Deploy m2-repo') {
			steps {
				dir ('peterlavalle.sbt/target/m2-repo/') {
					sh 'git add .'
					sh 'git commit -m "${BUILD_TAG}"'
					sh 'git push origin gh-pages'
				}
			}
		}
	}
}